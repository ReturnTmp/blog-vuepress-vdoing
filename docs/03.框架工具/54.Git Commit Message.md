---
title: Git æäº¤ã€å˜æ›´æ—¥å¿—å’Œç‰ˆæœ¬å‘å¸ƒæ ‡å‡†è‡ªåŠ¨åŒ–
date: 2023-11-28 20:40:36
permalink: /pages/ed0900/
categories:
  - æ¡†æ¶å·¥å…·
tags:
  - 
author: 
  name: ReturnTmp
  link: https://github.com/ReturnTmp
---

## å‰è¨€

commit message æ˜¯å¼€å‘çš„æ—¥å¸¸æ“ä½œ, ä¸€ä¸ªä¼˜ç§€çš„ message ä¸ä»…æœ‰åŠ©äºä»–äºº review, è¿˜å¯ä»¥æœ‰æ•ˆçš„è¾“å‡º CHANGELOG, å¯¹é¡¹ç›®çš„ç®¡ç†å®é™…è‡³å…³é‡è¦, ä½†æ˜¯å®é™…å·¥ä½œä¸­å´å¸¸å¸¸è¢«å¤§å®¶å¿½ç•¥ï¼Œå¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œèƒ½å¤Ÿå¸®åŠ©å¤§å®¶è§„èŒƒ commit message çš„ä¹¦å†™

## è§„èŒƒæ ¼å¼

> é‚£ä¹ˆå¦‚ä½•èƒ½ä¼˜é›…è€Œåˆä¸å¤±ä½“é¢çš„æäº¤ä½ çš„ä»£ç å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬çš„ `git commit message` æ˜¯åº”è¯¥å…·å¤‡ä¸€äº›è§„èŒƒçš„ã€‚ç›®å‰è§„èŒƒç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ [Angular å›¢é˜Ÿçš„è§„èŒƒ](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines)

message æ ·ä¾‹ï¼š

```text
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

- Typeï¼šå¿…é¡»æ˜¯ä¸‹åˆ—ä¹‹ä¸€

  - **feat**ï¼šä¸€ä¸ªæ–°åŠŸèƒ½

- **fix**ï¼šbug ä¿®å¤

  - **docs**ï¼šç¼–è¾‘æ–‡æ¡£
  - **style**ï¼šä¸å½±å“ä»£ç å«ä¹‰çš„æ›´æ”¹ (ç©ºæ ¼ã€æ ¼å¼ã€ç¼ºå°‘åˆ†å·ç­‰ï¼Œä¸æ˜¯ css çš„æ›´æ”¹)
  - **refactor**ï¼šæ—¢ä¸ä¿®å¤ bug ä¹Ÿä¸æ·»åŠ ç‰¹æ€§çš„ä»£ç æ›´æ”¹
  - **perf**ï¼šæé«˜æ€§èƒ½çš„ä»£ç æ›´æ”¹
  - **test**ï¼šæ·»åŠ ç¼ºå¤±çš„æˆ–çº æ­£ç°æœ‰çš„æµ‹è¯•
  - **chore**ï¼šå¯¹æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å’Œåº“ (å¦‚æ–‡æ¡£ç”Ÿæˆ)çš„æ›´æ”¹

- **Subject**ï¼šä¸»é¢˜åŒ…å«å¯¹å˜æ›´çš„ç®€æ´æè¿°

- **Body**ï¼šå…·ä½“çš„ä¿®æ”¹å†…å®¹ï¼Œå¯ä»¥åŒ…æ‹¬ä¸ä¹‹å‰çš„å¯¹æ¯”

- **Footer**ï¼šé€šå¸¸æ˜¯ BREAKING CHANGE æˆ–ä¿®å¤çš„ issue é“¾æ¥

## ç®€ä»‹

commitizen git commit æ ¼å¼åŒ–å·¥å…·, ä¸ºæˆ‘ä»¬æä¾›æ ‡å‡†åŒ–çš„ commit ä¿¡æ¯ã€‚å¸®åŠ©æˆ‘ä»¬ç»Ÿä¸€é¡¹ç›® commit ï¼Œä¾¿äºä¿¡æ¯çš„å›æº¯æˆ–æ—¥å¿—çš„ç”Ÿæˆã€‚# commit message æ ¼å¼

commitizen åªæ˜¯æä¾›ä¸€ä¸ª commit æ ¼å¼åŒ–æˆ–äº¤äº’å·¥å…·, æœ€ç»ˆéœ€è¦è¾“å‡ºç¬¦åˆ commit è§„åˆ™çš„ä¿¡æ¯ç»™ gitï¼Œæ‰€ä»¥éœ€è¦çº¿äº†è§£ commit æ ¼å¼è§„åˆ™

## å®‰è£…

```bash
npm install -D commitizen cz-conventional-changelog
```

package. json ä¸­æ·»åŠ 

```bash
  "scripts": {
  	...
    "commit": "git-cz"
  },
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-conventional-changelog"
    }
  }
```

### è‡ªå®šä¹‰ Adapter

å¦‚æœ Angular çš„è§„èŒƒä¸ç¬¦åˆæˆ‘ä»¬çš„å®é™…ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ [cz-customizable](https://github.com/leonardoanalista/cz-customizable) å®šåˆ¶ä¸€å¥—ç¬¦åˆè‡ªå·±æˆ–è€…å›¢é˜Ÿçš„è§„èŒƒã€‚

```bash
npm install -D cz-customizable
```

åŒæ—¶ package. json éœ€è¦ä¿®æ”¹

```json
"config": {
  "commitizen": {
    "path": "node_modules/cz-customizable"
  }
}
```

ä¹‹åå¯¹åº”é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .cz-config. js æ–‡ä»¶ï¼Œç”¨æ¥ç»´æŠ¤è‡ªå·±çš„æ ¼å¼

å®˜ç½‘ä¸­æœ‰å¯¹åº”çš„æ ·ä¾‹é…ç½®æ–‡ä»¶ï¼š[cz-customizable/cz-config-EXAMPLE.js at master Â· leoforfree/cz-customizable Â· GitHub](https://github.com/leoforfree/cz-customizable/blob/master/cz-config-EXAMPLE.js)

### æ ¡éªŒ Message

##### å·¥å…·ï¼š

å¯ä»¥åšåˆ°å¦‚æœä¸ç¬¦åˆæ ¡éªŒè§„èŒƒï¼Œå°±ä¼šç›´æ¥æ‹’ç» commit è¯·æ±‚

##### å®‰è£…

```bash
# Angular å›¢é˜Ÿçš„è§„èŒƒ
npm install -D @commitlint/config-conventional @commitlint/cli
# è‡ªå®šä¹‰è§„èŒƒ
npm install -D commitlint-config-cz @commitlint/cli
```

##### é…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ .commitlintrc. js

Angular å›¢é˜Ÿçš„è§„èŒƒ

```js
module.exports = {
  extends: [
    ''@commitlint/config-conventional''
  ],
  rules: {
  }
};
```

##### è‡ªå®šä¹‰è§„èŒƒ

```bash
module.exports = {
  extends: [
    'cz'
  ],
  rules: {
  }
};
```

### Husky

åœ¨åšå‰ç«¯å·¥ç¨‹åŒ–æ—¶ husky å¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¿…ä¸å¯å°‘çš„å·¥å…·ã€‚husky å¯ä»¥è®©æˆ‘ä»¬å‘é¡¹ç›®ä¸­æ–¹ä¾¿æ·»åŠ  git hooksã€‚

å®˜æ–¹é“¾æ¥ï¼š[typicode/husky: Git hooks made easy ğŸ¶ woof! (github.com)](https://github.com/typicode/husky)

#### å®‰è£…

```sh
npm install -D husky
```

#### é…ç½®

package. json ä¸­æ·»åŠ ï¼š

```json
"husky": {
    "hooks": {
      ...,
      "commit-msg": "commitlint -e $GIT_PARAMS"
    }
  },
```

æˆ–è€…åœ¨ .huskyrc æ–‡ä»¶ä¸­

```json
{
  "hooks": {
    ...,
    "commit-msg": "commitlint -e $GIT_PARAMS"
  }
}
```

## è‡ªåŠ¨åŒ–ç”Ÿæˆ

### å˜æ›´æ—¥å¿—ï¼ˆChangelogï¼‰

[conventional-changelog-cli]([conventional-changelog/packages/conventional-changelog-cli at master Â· conventional-changelog/conventional-changelog (github.com)](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli)) é»˜è®¤æ¨èçš„ commit æ ‡å‡†æ˜¯æ¥è‡ª angular é¡¹ç›®,é™¤äº† angular æ ‡å‡†ä»¥å¤–ï¼Œç›®å‰é›†æˆäº†åŒ…æ‹¬ atom, codemirror, ember, eslint, express, jquery ç­‰é¡¹ç›®çš„æ ‡å‡†ï¼Œå…·ä½“å¯ä»¥æ ¹æ®è‡ªå·±å£å‘³æ¥é€‰ç”¨ã€‚

**å…¨å±€å®‰è£…**

```bash
npm install -g conventional-changelog-cli
```

**åŸºæœ¬ä½¿ç”¨**

```bash
conventional-changelog -p angular -i CHANGELOG.md -s
```

ä»¥ä¸Šå‘½ä»¤ä¸­å‚æ•°-p angular ç”¨æ¥æŒ‡å®šä½¿ç”¨çš„ commit message æ ‡å‡†ï¼Œå‡å¦‚æƒ³ä½¿ç”¨ atom çš„æ ‡å‡†ï¼Œåˆ™æ˜¯ï¼š

```bash
conventional-changelog -p atom -i CHANGELOG.md -s
```

å‚æ•° -i CHANGELOG.md è¡¨ç¤ºä» Â `CHANGELOG.md`Â  è¯»å– changelog, -s è¡¨ç¤ºè¯»å†™ changelog ä¸ºåŒä¸€æ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢è¿™æ¡å‘½ä»¤äº§ç”Ÿçš„ changelog æ˜¯åŸºäºä¸Šæ¬¡ tag ç‰ˆæœ¬ä¹‹åçš„å˜æ›´ï¼ˆFeatureã€Fixã€Breaking Changes ç­‰ç­‰ï¼‰æ‰€äº§ç”Ÿçš„ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³ç”Ÿæˆä¹‹å‰æ‰€æœ‰ commit ä¿¡æ¯äº§ç”Ÿçš„ changelog åˆ™éœ€è¦ä½¿ç”¨è¿™æ¡å‘½ä»¤ï¼š

```bash
conventional-changelog -p angular -i CHANGELOG.md -s -r 0
```

å…¶ä¸­ -r è¡¨ç¤ºç”Ÿæˆ changelog æ‰€éœ€è¦ä½¿ç”¨çš„ release ç‰ˆæœ¬æ•°é‡ï¼Œé»˜è®¤ä¸º 1ï¼Œå…¨éƒ¨åˆ™æ˜¯ 0

**è‡ªå®šä¹‰å‚æ•°**

ç”Ÿæˆçš„ changlog ä¸­æœ‰äº›å¸¸ç”¨å†…å®¹å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‚æ•°æ¥æ ¹æ®éœ€æ±‚æ›´æ”¹ï¼Œä¾‹å¦‚ç‰ˆæœ¬å·ã€commit åœ°å€ç­‰ç­‰ã€‚ changelog ä¸­ç”Ÿæˆçš„ç‰ˆæœ¬å·å³æ˜¯ä» package.json ä¸­è·å– version å­—æ®µæ¥çš„ã€‚commit è¿æ¥çš„ä»“åº“åœ°å€æˆ‘ä»¬éœ€è¦ä¿®æ”¹ package.json ä¸­çš„ repository åœ°å€ï¼Œchangelog ä¸­ issuse é»˜è®¤çš„è¿æ¥åœ°å€ä¹Ÿæ˜¯æ ¹æ® repository æ¥ç”Ÿæˆçš„ã€‚å¦‚æœä½ ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹çš„åä½œç³»ç»Ÿï¼ˆä¾‹å¦‚ bitbucketï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ‡å‡†[conventional-changelog-angular-bitbucket]( https://link.juejin.cn/?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fuglow%2Fconventional-changelog-angular-bitbucket " https://link.zhihu.com/?target=https%3A//github.com/uglow/conventional-changelog-angular-bitbucket" )ã€‚æˆ–è€…åƒæˆ‘ä»¬ä½¿ç”¨ redmine æ¥ç®¡ç† isssue ï¼Œé‚£ä¹ˆåœ¨ç”Ÿæˆ changelog åå¯ä»¥ä½¿ç”¨Â [replace]( https://link.juejin.cn/?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fwww.npmjs.com%2Fpackage%2Freplace " https://link.zhihu.com/?target=https%3A//www.npmjs.com/package/replace" )Â å·¥å…·æ¥å¤„ç†æ–‡æœ¬ä¸­çš„åŸæœ‰åœ°å€ï¼š

```bash
replace 'https://github.com/myproject/issues/' 'https://redmine.example.com' CHANGELOG.md
```

æ›´å¤šé…ç½®ï¼š https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-core 

### ç‰ˆæœ¬å‘å¸ƒ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ standard-version å®ç°ç‰ˆæœ¬å‘å¸ƒè‡ªåŠ¨åŒ–

å…¨å±€å®‰è£…

```bash
npm install -g standard-version
```

æ‰§è¡Œ

```bash
standard-version
```

æ‰§è¡Œ standard-version å‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°æ•´ä¸ªæ‰§è¡Œæµç¨‹çš„ log ä¿¡æ¯ï¼Œåœ¨è¿™é‡Œå‡ ä¸ªå¸¸ç”¨çš„å‚æ•°éœ€è¦æ³¨æ„ä¸‹:

#### --release-as, -r æŒ‡å®šç‰ˆæœ¬å·

é»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥å…·ä¼šè‡ªåŠ¨æ ¹æ® ä¸»ç‰ˆæœ¬ï¼ˆÂ `major`Â ï¼‰,æ¬¡ç‰ˆæœ¬ï¼ˆÂ `minor`Â ï¼‰ or ä¿®è®¢ç‰ˆï¼ˆÂ `patch`Â ï¼‰ è§„åˆ™ç”Ÿæˆç‰ˆæœ¬å·ï¼Œä¾‹å¦‚å¦‚æœä½  package.json ä¸­çš„version ä¸º 1.0.0, é‚£ä¹ˆæ‰§è¡Œåç‰ˆæœ¬å·åˆ™æ˜¯ï¼š1.0.1ã€‚è‡ªå®šä¹‰å¯ä»¥é€šè¿‡ï¼š

bash

å¤åˆ¶ä»£ç 

`$ standard-version -r minor output 1.1.0`

bash

å¤åˆ¶ä»£ç 

`$ standard-version -r 2.0.0 output 2.0.0`

bash

å¤åˆ¶ä»£ç 

`$ standard-version -r 2.0.0-test output 2.0.0-test`

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ç‰ˆæœ¬åç§°ä¸æ˜¯éšä¾¿çš„å­—ç¬¦ï¼Œè€Œæ˜¯éœ€è¦éµå¾ªÂ [è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆ semverï¼‰](https://link.juejin.cn/?target=https%3A%2F%2Fsemver.org%2F "https://semver.org/")Â è§„èŒƒçš„

#### --prerelease, -p é¢„å‘ç‰ˆæœ¬å‘½å

ç”¨æ¥ç”Ÿæˆé¢„å‘ç‰ˆæœ¬, å¦‚æœå½“æœŸçš„ç‰ˆæœ¬å·æ˜¯ 2.0.0ï¼Œä¾‹å¦‚:

bash

å¤åˆ¶ä»£ç 

`$ standard-version --prerelease alpha output 2.0.0-alpha.0`

#### --tag-prefix, -t ç‰ˆæœ¬ tag å‰ç¼€

ç”¨æ¥ç»™ç”Ÿæˆ tag æ ‡ç­¾æ·»åŠ å‰ç¼€ï¼Œä¾‹å¦‚å¦‚æœå‰ç‰ˆæœ¬å·ä¸º 2.0.0ï¼Œåˆ™ï¼š

bash

å¤åˆ¶ä»£ç 

`$ standard-version --tag-prefix "stable-" output tag: stable-v2.0.0`

ä»¥ä¸Šè¿™å‡ ä¸ªå‚æ•°å¯èƒ½æˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šï¼Œè¿˜æœ‰å…¶ä»–é€‰é¡¹å¯ä»¥é€šè¿‡Â `standard-version --help`Â æŸ¥çœ‹ã€‚

#### é›†æˆ npm

æœ€åè®°å¾—æŠŠå‘½ä»¤é›†æˆåˆ° npm package.jsonçš„ scripts ä¸­, å¹¶é…åˆ shell è„šæœ¬ä½¿ç”¨, å¦‚ä¸‹ï¼š

```json
"scripts": {
  "release": "./scripts/release.sh",
  "changelog": "conventional-changelog -p angular -i CHANGELOG.md -s -r 0 && git add CHANGELOG.md && npm run changeissueurl",
  "changeissueurl": "replace 'https://github.com/myproject/issues/' 'https://redmine.example.com/' CHANGELOG.md"
},
```

é…ç½®å¥½åä½¿ç”¨ npm run æ‰§è¡Œå‘å¸ƒ

`$ npm run release`

#### æ·»åŠ  release.sh è„šæœ¬ï¼š

```bash
#!/bin/bash

while [[ "$#" > 0 ]]; 
do 
    case $1 in
    -r|--release) release="$2"; shift;;
    # -b|--branch) branch="$2"; shift;;
    -t|--tag-prefix) prefix="$2"; shift;;
    -p|--prerelease) prerelease="$2"; shift;;
    -n|--no-verify) no="true"; shift;;
    *) echo "âŒâŒâŒ Unknown parameter passed: $1"; exit 1;;
    esac; shift; 
done

# Default as minor, the argument major, minor or patch: 
if [ -z "$release" ]; then
    release="patch";
fi

echo "ğŸ‘ŒğŸ» Release as $release"

# Default release branch is master 
# if [ -z "$branch" ] ; then
#     branch=""; 
# fi;

# if [ "$branch" ]; 
# then
#     echo "âœ” Branch is $branch"
# else
#     echo "âœ” Branch is current branch"
# fi;

# git pull origin $branch
# echo "âœ” Current pull origin $branch."


# Generate version number and tag
if [ "$no" ]
then
    standard-version --no-erify --infile CHANGELOG.md
    echo "ğŸ‘ŒğŸ» no-erify"
else 
    standard-version -r $release --tag-prefix $prefix --prerelease $prerelease --infile CHANGELOG.md
fi;

git push --follow-tags
echo 'âœ… git push success'

npm publish

echo "ğŸ‰ğŸ‰ğŸ‰ Release finished."

```

ä¸Šé¢çš„è„šæœ¬åªæ˜¯åšäº†ç®€å•çš„åˆ†æ”¯ pull, æ‰§è¡Œ standard-version å’Œæœ€åçš„ç‰ˆæœ¬ push å·¥ä½œï¼Œå¦‚æœè¦åšä¸€äº›å®šåˆ¶åŒ–çš„æ‰§è¡Œå‚æ•°ï¼Œåˆ™éœ€è¦åšå®šåˆ¶ä¿®æ”¹äº†

## å‚è€ƒé“¾æ¥

- [git commit è§„èŒƒ ã€CHANGELOG ç”Ÿæˆ å’Œç‰ˆæœ¬å‘å¸ƒçš„æ ‡å‡†è‡ªåŠ¨åŒ– - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7053730154710827045#heading-10)
- [git commit ã€CHANGELOG å’Œç‰ˆæœ¬å‘å¸ƒçš„æ ‡å‡†è‡ªåŠ¨åŒ– - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844903733818556429)
- [Commit message å’Œ Change log ç¼–å†™æŒ‡å— - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)](http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)
